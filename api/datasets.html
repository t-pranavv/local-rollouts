
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Datasets &#8212; PhyAGI</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=328381f7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'api/datasets';</script>
    <link rel="canonical" href="https://microsoft.github.io/phyagi/api/datasets.html" />
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Models" href="models.html" />
    <link rel="prev" title="Tests" href="../contributing/tests.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="Sep 16, 2025"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt=""/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt=""/>`);</script>
  
  
    <p class="title logo__title">PhyAGI</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/build_docker.html">Build a Docker image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/quick_start.html">Quick start</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Guides</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../guides/logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/configuration_system.html">Configuration system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/cli.html">Command-Line Interface (CLI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/data_generation_infrastructure.html">Data generation infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/llama_cpp_and_gguf.html">Llama.cpp and GGUF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../tutorials/data_related.html">Data‑related</a></li>


<li class="toctree-l1"><a class="reference internal" href="../tutorials/model_architecture.html">Model architecture</a></li>

<li class="toctree-l1"><a class="reference internal" href="../tutorials/training.html">Training</a></li>

<li class="toctree-l1"><a class="reference internal" href="../tutorials/sft.html">Supervised Fine-Tuning (SFT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/rlhf.html">Reinforcement Learning from Human Feedback (RLHF)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/evaluation.html">Evaluation</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../advanced_tutorials/lr_schedulers.html">Learning rate schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_tutorials/optimizers.html">Optimizers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_tutorials/parameter_efficient.html">Parameter-Efficient Techniques (PEFT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_tutorials/batch_tracking.html">Batch tracking</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Azure</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../azure/sc_alt.html">Log-In with SC-ALT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/pim.html">Elevate permissions with Privileged Identity Management (PIM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/singularity.html">Submiting jobs with Singularity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/storage_account.html">Azure Storage Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/virtual_machine.html">Azure Virtual Machine (VM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/container_registry.html">Azure Container Registry (ACR)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/app_service.html">Azure App Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/kubernetes_service.html">Azure Kubernetes Service (AKS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/entra.html">Microsoft Entra</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../contributing/first_time_contributor.html">First time contributor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/tests.html">Tests</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimizers.html">Optimizers</a></li>
<li class="toctree-l1"><a class="reference internal" href="trainers.html">Trainers</a></li>
<li class="toctree-l1"><a class="reference internal" href="rl.html">Reinforcement Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="eval.html">Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">CLI</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/microsoft/phyagi" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/microsoft/phyagi/issues/new?title=Issue%20on%20page%20%2Fapi/datasets.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Datasets</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Sections </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-providers-abstract">Dataset Providers (Abstract)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.dataset_provider.DatasetProvider"><code class="docutils literal notranslate"><span class="pre">DatasetProvider</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.dataset_provider.DatasetProvider.__init__"><code class="docutils literal notranslate"><span class="pre">DatasetProvider.__init__()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.dataset_provider.DatasetProvider.from_config"><code class="docutils literal notranslate"><span class="pre">DatasetProvider.from_config()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.dataset_provider.DatasetProvider.get_train_dataset"><code class="docutils literal notranslate"><span class="pre">DatasetProvider.get_train_dataset()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.dataset_provider.DatasetProvider.get_val_dataset"><code class="docutils literal notranslate"><span class="pre">DatasetProvider.get_val_dataset()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.dataset_provider.DatasetProvider.get_tokenizer"><code class="docutils literal notranslate"><span class="pre">DatasetProvider.get_tokenizer()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.dataset_provider.DatasetProviderConfig"><code class="docutils literal notranslate"><span class="pre">DatasetProviderConfig</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.dataset_provider.DatasetProviderConfig.from_dict"><code class="docutils literal notranslate"><span class="pre">DatasetProviderConfig.from_dict()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.dataset_provider.DatasetProviderConfig.to_dict"><code class="docutils literal notranslate"><span class="pre">DatasetProviderConfig.to_dict()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.dataset_provider.DatasetProviderConfig.__init__"><code class="docutils literal notranslate"><span class="pre">DatasetProviderConfig.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#datasets-concatenation">Datasets Concatenation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatDataset"><code class="docutils literal notranslate"><span class="pre">WeightedConcatDataset</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatDataset.__init__"><code class="docutils literal notranslate"><span class="pre">WeightedConcatDataset.__init__()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatDataset.seq_len"><code class="docutils literal notranslate"><span class="pre">WeightedConcatDataset.seq_len</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.SequentialWeightedConcatDataset"><code class="docutils literal notranslate"><span class="pre">SequentialWeightedConcatDataset</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.SequentialWeightedConcatDataset.__init__"><code class="docutils literal notranslate"><span class="pre">SequentialWeightedConcatDataset.__init__()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset"><code class="docutils literal notranslate"><span class="pre">WeightedConcatIterableDataset</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.__init__"><code class="docutils literal notranslate"><span class="pre">WeightedConcatIterableDataset.__init__()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.seq_len"><code class="docutils literal notranslate"><span class="pre">WeightedConcatIterableDataset.seq_len</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.set_rank_and_world_size"><code class="docutils literal notranslate"><span class="pre">WeightedConcatIterableDataset.set_rank_and_world_size()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.state_dict"><code class="docutils literal notranslate"><span class="pre">WeightedConcatIterableDataset.state_dict()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.load_state_dict"><code class="docutils literal notranslate"><span class="pre">WeightedConcatIterableDataset.load_state_dict()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.save_state"><code class="docutils literal notranslate"><span class="pre">WeightedConcatIterableDataset.save_state()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.load_state"><code class="docutils literal notranslate"><span class="pre">WeightedConcatIterableDataset.load_state()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatChatDataset"><code class="docutils literal notranslate"><span class="pre">WeightedConcatChatDataset</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatChatDataset.__init__"><code class="docutils literal notranslate"><span class="pre">WeightedConcatChatDataset.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-training">Pre-training</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#datasets-providers">Datasets Providers</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider"><code class="docutils literal notranslate"><span class="pre">LMDatasetProvider</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.__init__"><code class="docutils literal notranslate"><span class="pre">LMDatasetProvider.__init__()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.from_hub"><code class="docutils literal notranslate"><span class="pre">LMDatasetProvider.from_hub()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.from_cache"><code class="docutils literal notranslate"><span class="pre">LMDatasetProvider.from_cache()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.get_train_dataset"><code class="docutils literal notranslate"><span class="pre">LMDatasetProvider.get_train_dataset()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.get_val_dataset"><code class="docutils literal notranslate"><span class="pre">LMDatasetProvider.get_val_dataset()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.get_tokenizer"><code class="docutils literal notranslate"><span class="pre">LMDatasetProvider.get_tokenizer()</span></code></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProviderConfig"><code class="docutils literal notranslate"><span class="pre">StreamLMDatasetProviderConfig</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProviderConfig.from_dict"><code class="docutils literal notranslate"><span class="pre">StreamLMDatasetProviderConfig.from_dict()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProviderConfig.to_dict"><code class="docutils literal notranslate"><span class="pre">StreamLMDatasetProviderConfig.to_dict()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProviderConfig.__init__"><code class="docutils literal notranslate"><span class="pre">StreamLMDatasetProviderConfig.__init__()</span></code></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProvider"><code class="docutils literal notranslate"><span class="pre">StreamLMDatasetProvider</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProvider.__init__"><code class="docutils literal notranslate"><span class="pre">StreamLMDatasetProvider.__init__()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProvider.get_train_dataset"><code class="docutils literal notranslate"><span class="pre">StreamLMDatasetProvider.get_train_dataset()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProvider.get_val_dataset"><code class="docutils literal notranslate"><span class="pre">StreamLMDatasetProvider.get_val_dataset()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProvider.get_tokenizer"><code class="docutils literal notranslate"><span class="pre">StreamLMDatasetProvider.get_tokenizer()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Datasets</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.lm.lm_dataset.LMDataset"><code class="docutils literal notranslate"><span class="pre">LMDataset</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.lm.lm_dataset.LMDataset.__init__"><code class="docutils literal notranslate"><span class="pre">LMDataset.__init__()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.lm.lm_dataset.LMDataset.seq_len"><code class="docutils literal notranslate"><span class="pre">LMDataset.seq_len</span></code></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset"><code class="docutils literal notranslate"><span class="pre">StreamLMDataset</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset.__init__"><code class="docutils literal notranslate"><span class="pre">StreamLMDataset.__init__()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset.seq_len"><code class="docutils literal notranslate"><span class="pre">StreamLMDataset.seq_len</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset.set_rank_and_world_size"><code class="docutils literal notranslate"><span class="pre">StreamLMDataset.set_rank_and_world_size()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset.state_dict"><code class="docutils literal notranslate"><span class="pre">StreamLMDataset.state_dict()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset.load_state_dict"><code class="docutils literal notranslate"><span class="pre">StreamLMDataset.load_state_dict()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-collators">Data Collators</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.train_data_collator.LMDataCollator"><code class="docutils literal notranslate"><span class="pre">LMDataCollator</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.train_data_collator.LMDataCollator.__init__"><code class="docutils literal notranslate"><span class="pre">LMDataCollator.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-phyagi.datasets.rl.formatting_utils">Reinforcement Learning</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.formatting_utils.apply_chat_template"><code class="docutils literal notranslate"><span class="pre">apply_chat_template()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.formatting_utils.patch_tokenizer_generation_tag"><code class="docutils literal notranslate"><span class="pre">patch_tokenizer_generation_tag()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.packing.PackedBatch"><code class="docutils literal notranslate"><span class="pre">PackedBatch</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.packing.PackedBatch.to"><code class="docutils literal notranslate"><span class="pre">PackedBatch.to()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.packing.PackedBatch.to_dict"><code class="docutils literal notranslate"><span class="pre">PackedBatch.to_dict()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.packing.PackedBatch.from_dict"><code class="docutils literal notranslate"><span class="pre">PackedBatch.from_dict()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.packing.distribute_and_pack_sequences"><code class="docutils literal notranslate"><span class="pre">distribute_and_pack_sequences()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.special_tokens.get_special_token"><code class="docutils literal notranslate"><span class="pre">get_special_token()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.special_tokens.get_mask_token"><code class="docutils literal notranslate"><span class="pre">get_mask_token()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Datasets Providers</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProviderConfig"><code class="docutils literal notranslate"><span class="pre">ChatDatasetProviderConfig</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProviderConfig.from_dict"><code class="docutils literal notranslate"><span class="pre">ChatDatasetProviderConfig.from_dict()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProviderConfig.to_dict"><code class="docutils literal notranslate"><span class="pre">ChatDatasetProviderConfig.to_dict()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProviderConfig.__init__"><code class="docutils literal notranslate"><span class="pre">ChatDatasetProviderConfig.__init__()</span></code></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProvider"><code class="docutils literal notranslate"><span class="pre">ChatDatasetProvider</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProvider.__init__"><code class="docutils literal notranslate"><span class="pre">ChatDatasetProvider.__init__()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProvider.get_train_dataset"><code class="docutils literal notranslate"><span class="pre">ChatDatasetProvider.get_train_dataset()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProvider.get_val_dataset"><code class="docutils literal notranslate"><span class="pre">ChatDatasetProvider.get_val_dataset()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProvider.get_tokenizer"><code class="docutils literal notranslate"><span class="pre">ChatDatasetProvider.get_tokenizer()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Datasets</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset.ChatDataset"><code class="docutils literal notranslate"><span class="pre">ChatDataset</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset.ChatDataset.__init__"><code class="docutils literal notranslate"><span class="pre">ChatDataset.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Data Collators</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.rl_data_collator.RewardDataCollator"><code class="docutils literal notranslate"><span class="pre">RewardDataCollator</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.rl_data_collator.RewardDataCollator.__init__"><code class="docutils literal notranslate"><span class="pre">RewardDataCollator.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-phyagi.datasets.registry">Registry</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.registry.get_dataset"><code class="docutils literal notranslate"><span class="pre">get_dataset()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.registry.get_data_collator"><code class="docutils literal notranslate"><span class="pre">get_data_collator()</span></code></a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="datasets">
<h1>Datasets<a class="headerlink" href="#datasets" title="Link to this heading">#</a></h1>
<section id="dataset-providers-abstract">
<h2>Dataset Providers (Abstract)<a class="headerlink" href="#dataset-providers-abstract" title="Link to this heading">#</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="phyagi.datasets.dataset_provider.DatasetProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phyagi.datasets.dataset_provider.</span></span><span class="sig-name descname"><span class="pre">DatasetProvider</span></span><a class="reference internal" href="../_modules/phyagi/datasets/dataset_provider.html#DatasetProvider"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.dataset_provider.DatasetProvider" title="Link to this definition">#</a></dt>
<dd><p>Abstract class for dataset providers.</p>
<p>This class serves as a base for implementing dataset providers that can return
training and validation datasets. It enforces implementation of three methods:
<a class="reference internal" href="#phyagi.datasets.dataset_provider.DatasetProvider.get_train_dataset" title="phyagi.datasets.dataset_provider.DatasetProvider.get_train_dataset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_train_dataset()</span></code></a>, <a class="reference internal" href="#phyagi.datasets.dataset_provider.DatasetProvider.get_val_dataset" title="phyagi.datasets.dataset_provider.DatasetProvider.get_val_dataset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_val_dataset()</span></code></a> and <a class="reference internal" href="#phyagi.datasets.dataset_provider.DatasetProvider.get_tokenizer" title="phyagi.datasets.dataset_provider.DatasetProvider.get_tokenizer"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_tokenizer()</span></code></a>.</p>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">MyDatasetProvider</span><span class="p">(</span><span class="n">DatasetProvider</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span><span class="w"> </span><span class="nf">get_train_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dataset</span><span class="p">]:</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="k">return</span> <span class="n">torchvision</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">MNIST</span><span class="p">(</span><span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span><span class="w"> </span><span class="nf">get_val_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dataset</span><span class="p">]:</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="k">return</span> <span class="n">torchvision</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">MNIST</span><span class="p">(</span><span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tokenizer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="k">return</span> <span class="n">transformers</span><span class="o">.</span><span class="n">AutoTokenizer</span><span class="p">()</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.dataset_provider.DatasetProvider.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/dataset_provider.html#DatasetProvider.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.dataset_provider.DatasetProvider.__init__" title="Link to this definition">#</a></dt>
<dd><p>Initialize the dataset provider.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.dataset_provider.DatasetProvider.from_config">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#phyagi.datasets.dataset_provider.DatasetProviderConfig" title="phyagi.datasets.dataset_provider.DatasetProviderConfig"><span class="pre">DatasetProviderConfig</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#phyagi.datasets.dataset_provider.DatasetProvider" title="phyagi.datasets.dataset_provider.DatasetProvider"><span class="pre">DatasetProvider</span></a></span></span><a class="reference internal" href="../_modules/phyagi/datasets/dataset_provider.html#DatasetProvider.from_config"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.dataset_provider.DatasetProvider.from_config" title="Link to this definition">#</a></dt>
<dd><p>Load a dataset provider from a configuration.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>config</strong> – Dataset provider configuration.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dataset provider.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.dataset_provider.DatasetProvider.get_train_dataset">
<span class="sig-name descname"><span class="pre">get_train_dataset</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dataset</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/dataset_provider.html#DatasetProvider.get_train_dataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.dataset_provider.DatasetProvider.get_train_dataset" title="Link to this definition">#</a></dt>
<dd><p>Get a training dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>An instance of a training dataset.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.dataset_provider.DatasetProvider.get_val_dataset">
<span class="sig-name descname"><span class="pre">get_val_dataset</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dataset</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/dataset_provider.html#DatasetProvider.get_val_dataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.dataset_provider.DatasetProvider.get_val_dataset" title="Link to this definition">#</a></dt>
<dd><p>Get a validation dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>An instance of a validation dataset.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.dataset_provider.DatasetProvider.get_tokenizer">
<span class="sig-name descname"><span class="pre">get_tokenizer</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/dataset_provider.html#DatasetProvider.get_tokenizer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.dataset_provider.DatasetProvider.get_tokenizer" title="Link to this definition">#</a></dt>
<dd><p>Get a tokenizer.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>An instance of a tokenizer.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="phyagi.datasets.dataset_provider.DatasetProviderConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phyagi.datasets.dataset_provider.</span></span><span class="sig-name descname"><span class="pre">DatasetProviderConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cache_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_split</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tokenizer_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seq_len</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2048</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift_labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_token_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_mask_prob</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phyagi/datasets/dataset_provider.html#DatasetProviderConfig"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.dataset_provider.DatasetProviderConfig" title="Link to this definition">#</a></dt>
<dd><p>Dataset provider configuration (used as default for language modeling datasets).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cache_dir</strong> – Path to the cached dataset directory.</p></li>
<li><p><strong>train_file</strong> – Path to the cached <code class="docutils literal notranslate"><span class="pre">.npy</span></code> train file.</p></li>
<li><p><strong>validation_file</strong> – Path to the cached <code class="docutils literal notranslate"><span class="pre">.npy</span></code> validation file.</p></li>
<li><p><strong>validation_split</strong> – Part of the training dataset to be used for dynamic validation dataset creation.
If type is <code class="docutils literal notranslate"><span class="pre">int</span></code>, will use number of tokens from the training dataset.
If type is <code class="docutils literal notranslate"><span class="pre">float</span></code>, will use fraction of the training dataset.</p></li>
<li><p><strong>tokenizer_file</strong> – Path to the cached <code class="docutils literal notranslate"><span class="pre">.pkl</span></code> tokenizer file.</p></li>
<li><p><strong>seq_len</strong> – Sequence length.</p></li>
<li><p><strong>shift_labels</strong> – Whether to shift labels.</p></li>
<li><p><strong>weight</strong> – Weight for the dataset.</p></li>
<li><p><strong>label</strong> – Label for the dataset.</p></li>
<li><p><strong>ignore_token_id</strong> – Index to be ignored in the labels.</p></li>
<li><p><strong>seed</strong> – Random seed.</p></li>
<li><p><strong>random_mask_prob</strong> – Probability of applying a mask that ignores random samples (sequence lengths).
If <code class="docutils literal notranslate"><span class="pre">None</span></code>, ignores masking.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.dataset_provider.DatasetProviderConfig.from_dict">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#phyagi.datasets.dataset_provider.DatasetProviderConfig" title="phyagi.datasets.dataset_provider.DatasetProviderConfig"><span class="pre">DatasetProviderConfig</span></a></span></span><a class="reference internal" href="../_modules/phyagi/datasets/dataset_provider.html#DatasetProviderConfig.from_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.dataset_provider.DatasetProviderConfig.from_dict" title="Link to this definition">#</a></dt>
<dd><p>Load a configuration from a dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>config_dict</strong> – Dictionary containing the configuration.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Configuration.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.dataset_provider.DatasetProviderConfig.to_dict">
<span class="sig-name descname"><span class="pre">to_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/dataset_provider.html#DatasetProviderConfig.to_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.dataset_provider.DatasetProviderConfig.to_dict" title="Link to this definition">#</a></dt>
<dd><p>Convert the configuration to a dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dictionary containing the configuration.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.dataset_provider.DatasetProviderConfig.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cache_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_split</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tokenizer_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seq_len</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2048</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift_labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_token_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_mask_prob</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#phyagi.datasets.dataset_provider.DatasetProviderConfig.__init__" title="Link to this definition">#</a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="datasets-concatenation">
<h2>Datasets Concatenation<a class="headerlink" href="#datasets-concatenation" title="Link to this heading">#</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="phyagi.datasets.concat_dataset.WeightedConcatDataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phyagi.datasets.concat_dataset.</span></span><span class="sig-name descname"><span class="pre">WeightedConcatDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datasets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Dataset</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phyagi/datasets/concat_dataset.html#WeightedConcatDataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.concat_dataset.WeightedConcatDataset" title="Link to this definition">#</a></dt>
<dd><p>Weighted concatenation of datasets.</p>
<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.concat_dataset.WeightedConcatDataset.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datasets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Dataset</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/concat_dataset.html#WeightedConcatDataset.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.concat_dataset.WeightedConcatDataset.__init__" title="Link to this definition">#</a></dt>
<dd><p>Initialize the dataset by concatenating the given datasets according
to the given weights.</p>
<p>For a given dataset, the number of resulting samples is computed as
<code class="docutils literal notranslate"><span class="pre">ceil(len(dataset)</span> <span class="pre">*</span> <span class="pre">weight)</span></code>. If the resulting number of samples is
greater than the length of the dataset, the dataset is concatenated
multiple times to reach the desired number of samples.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>datasets</strong> – List of datasets.</p></li>
<li><p><strong>weights</strong> – List of weights.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="phyagi.datasets.concat_dataset.WeightedConcatDataset.seq_len">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">seq_len</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#phyagi.datasets.concat_dataset.WeightedConcatDataset.seq_len" title="Link to this definition">#</a></dt>
<dd><p>Sequence length of the dataset used for logging.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="phyagi.datasets.concat_dataset.SequentialWeightedConcatDataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phyagi.datasets.concat_dataset.</span></span><span class="sig-name descname"><span class="pre">SequentialWeightedConcatDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datasets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Dataset</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phyagi/datasets/concat_dataset.html#SequentialWeightedConcatDataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.concat_dataset.SequentialWeightedConcatDataset" title="Link to this definition">#</a></dt>
<dd><p>Sequential weighted concatenation of datasets.</p>
<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.concat_dataset.SequentialWeightedConcatDataset.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datasets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Dataset</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/concat_dataset.html#SequentialWeightedConcatDataset.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.concat_dataset.SequentialWeightedConcatDataset.__init__" title="Link to this definition">#</a></dt>
<dd><p>Initialize the dataset by sequentially concatenating the given datasets according
to the given weights.</p>
<p>The concatenating order is determined by the order of the given datasets. If a given
dataset has a weight greater than 1, it will be sequentially concatenated multiple times.</p>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span> <span class="o">=</span> <span class="n">SequentialWeightedConcatDataset</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>datasets</strong> – List of datasets.</p></li>
<li><p><strong>weights</strong> – List of weights.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="phyagi.datasets.concat_dataset.WeightedConcatIterableDataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phyagi.datasets.concat_dataset.</span></span><span class="sig-name descname"><span class="pre">WeightedConcatIterableDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datasets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">IterableDataset</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phyagi/datasets/concat_dataset.html#WeightedConcatIterableDataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset" title="Link to this definition">#</a></dt>
<dd><p>Weighted concatenation of multiple iterable datasets.</p>
<p>Each step we draw a uniform random number, pick the dataset whose cumulative distribution function (CDF)
interval contains it, and yield <strong>one</strong> sample from that dataset.</p>
<ul class="simple">
<li><p>No in-RAM shuffling: each underlying file is assumed pre-shuffled.</p></li>
<li><p>Per-worker random number generator (RNG): distinct GPUs (and dataloader workers).</p></li>
<li><p>Tiny checkpoints: we store only a few integers per shard.</p></li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datasets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">IterableDataset</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/concat_dataset.html#WeightedConcatIterableDataset.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.__init__" title="Link to this definition">#</a></dt>
<dd><p>Initialize the dataset by concatenating the given datasets according
to the given weights.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>datasets</strong> – Iterable of already-constructed <a class="reference internal" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset" title="phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset</span></code></a>.</p></li>
<li><p><strong>weights</strong> – Relative sampling probabilities, which are normalized to sum to 1.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.seq_len">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">seq_len</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.seq_len" title="Link to this definition">#</a></dt>
<dd><p>Sequence length of the dataset used for logging.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.set_rank_and_world_size">
<span class="sig-name descname"><span class="pre">set_rank_and_world_size</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rank</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">world_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/concat_dataset.html#WeightedConcatIterableDataset.set_rank_and_world_size"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.set_rank_and_world_size" title="Link to this definition">#</a></dt>
<dd><p>Set the rank and world size for distributed training.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rank</strong> – Rank of the current process.</p></li>
<li><p><strong>world_size</strong> – Number of processes in the world.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.state_dict">
<span class="sig-name descname"><span class="pre">state_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/concat_dataset.html#WeightedConcatIterableDataset.state_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.state_dict" title="Link to this definition">#</a></dt>
<dd><p>State of the dataset as a dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dictionary containing the current step count and the state of each dataset.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.load_state_dict">
<span class="sig-name descname"><span class="pre">load_state_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/concat_dataset.html#WeightedConcatIterableDataset.load_state_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.load_state_dict" title="Link to this definition">#</a></dt>
<dd><p>Load the state of the dataset from a dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> – Dictionary containing the state of the dataset.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.save_state">
<span class="sig-name descname"><span class="pre">save_state</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/concat_dataset.html#WeightedConcatIterableDataset.save_state"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.save_state" title="Link to this definition">#</a></dt>
<dd><p>Save the state of the datasets.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output_dir</strong> – Output directory.</p></li>
<li><p><strong>step</strong> – Step number.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.load_state">
<span class="sig-name descname"><span class="pre">load_state</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">load_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/concat_dataset.html#WeightedConcatIterableDataset.load_state"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.load_state" title="Link to this definition">#</a></dt>
<dd><p>Load the state of the datasets.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>load_dir</strong> – Load directory.</p></li>
<li><p><strong>step</strong> – Step number.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="phyagi.datasets.concat_dataset.WeightedConcatChatDataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phyagi.datasets.concat_dataset.</span></span><span class="sig-name descname"><span class="pre">WeightedConcatChatDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datasets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Dataset</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phyagi/datasets/concat_dataset.html#WeightedConcatChatDataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.concat_dataset.WeightedConcatChatDataset" title="Link to this definition">#</a></dt>
<dd><p>Weighted concatenation of chat datasets.</p>
<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.concat_dataset.WeightedConcatChatDataset.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datasets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Dataset</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/concat_dataset.html#WeightedConcatChatDataset.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.concat_dataset.WeightedConcatChatDataset.__init__" title="Link to this definition">#</a></dt>
<dd><p>Initialize the dataset by concatenating the given chat datasets according
to the given weights.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>datasets</strong> – Chat-based datasets.</p></li>
<li><p><strong>weights</strong> – Weights for each dataset.</p></li>
<li><p><strong>labels</strong> – Labels for each dataset.
If not provided, labels will be generated as “0”, “1”, “2”, etc.
If only one dataset is provided, the label will be <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="pre-training">
<h2>Pre-training<a class="headerlink" href="#pre-training" title="Link to this heading">#</a></h2>
<section id="datasets-providers">
<h3>Datasets Providers<a class="headerlink" href="#datasets-providers" title="Link to this heading">#</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phyagi.datasets.train.lm.lm_dataset_provider.</span></span><span class="sig-name descname"><span class="pre">LMDatasetProvider</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">train_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_split</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tokenizer_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seq_len</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2048</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift_labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_token_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_mask_prob</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phyagi/datasets/train/lm/lm_dataset_provider.html#LMDatasetProvider"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider" title="Link to this definition">#</a></dt>
<dd><p>Language modeling dataset provider.</p>
<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">train_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_split</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tokenizer_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seq_len</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2048</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift_labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_token_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_mask_prob</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/train/lm/lm_dataset_provider.html#LMDatasetProvider.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.__init__" title="Link to this definition">#</a></dt>
<dd><p>Initialize the dataset provider.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>train_file</strong> – Path to the <code class="docutils literal notranslate"><span class="pre">.npy</span></code> training array file.</p></li>
<li><p><strong>validation_file</strong> – Path to the <code class="docutils literal notranslate"><span class="pre">.npy</span></code> validation array file.</p></li>
<li><p><strong>validation_split</strong> – Part of the training dataset to be used for dynamic validation dataset creation.
If type is <code class="docutils literal notranslate"><span class="pre">int</span></code>, will use number of tokens from the training dataset.
If type is <code class="docutils literal notranslate"><span class="pre">float</span></code>, will use fraction of the training dataset.</p></li>
<li><p><strong>tokenizer_file</strong> – Path to the <code class="docutils literal notranslate"><span class="pre">.pkl</span></code> tokenizer file.</p></li>
<li><p><strong>seq_len</strong> – Sequence length.</p></li>
<li><p><strong>shift_labels</strong> – Whether to shift labels.</p></li>
<li><p><strong>weight</strong> – Weight for the dataset.</p></li>
<li><p><strong>label</strong> – Label for the dataset.</p></li>
<li><p><strong>ignore_token_id</strong> – Index to be ignored in the labels.</p></li>
<li><p><strong>random_mask_prob</strong> – Probability of applying a mask that ignores random samples (sequence lengths).
If <code class="docutils literal notranslate"><span class="pre">None</span></code>, ignores masking.</p></li>
<li><p><strong>seed</strong> – Seed for the mask random number generator.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.from_hub">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_hub</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">disk_file_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_files</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">revision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tokenizer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">PreTrainedTokenizerBase</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapping_fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapping_fn_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapping_column_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_split</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shuffle</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_workers</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_eos_token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_shared_memory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'cache'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raw_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider" title="phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider"><span class="pre">LMDatasetProvider</span></a></span></span><a class="reference internal" href="../_modules/phyagi/datasets/train/lm/lm_dataset_provider.html#LMDatasetProvider.from_hub"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.from_hub" title="Link to this definition">#</a></dt>
<dd><p>Load a dataset provider by downloading and tokenizing data from Hugging Face hub.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset_path</strong> – Path of the dataset when loading with <code class="docutils literal notranslate"><span class="pre">load_dataset()</span></code>.</p></li>
<li><p><strong>dataset_name</strong> – Name of the dataset when loading with <code class="docutils literal notranslate"><span class="pre">load_dataset()</span></code>.</p></li>
<li><p><strong>disk_file_path</strong> – Path of the disk file when loading with <code class="docutils literal notranslate"><span class="pre">load_from_disk()</span></code>.
If different than <code class="docutils literal notranslate"><span class="pre">None</span></code>, will override dataset downloaded from Hugging Face hub.</p></li>
<li><p><strong>data_dir</strong> – Path to the data directory.</p></li>
<li><p><strong>data_files</strong> – Path to the source data files.</p></li>
<li><p><strong>revision</strong> – Version of the dataset.</p></li>
<li><p><strong>tokenizer</strong> – Instance of tokenizer to use.
If type is <code class="docutils literal notranslate"><span class="pre">str</span></code>, will use <code class="xref py py-class docutils literal notranslate"><span class="pre">transformers.AutoTokenizer</span></code> to load the tokenizer.</p></li>
<li><p><strong>mapping_fn</strong> – A function that maps the dataset.
If set to <code class="docutils literal notranslate"><span class="pre">None</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">phyagi.datasets.train.lm.lm_dataset_provider._tokenize_concatenated()</span></code> will be used.</p></li>
<li><p><strong>mapping_fn_kwargs</strong> – Keyword arguments to be passed to <code class="docutils literal notranslate"><span class="pre">mapping_fn</span></code>.</p></li>
<li><p><strong>mapping_column_name</strong> – Columns in the dataset to be tokenized.
If type is <code class="docutils literal notranslate"><span class="pre">str</span></code>, only one column will be tokenized.
If type is <code class="docutils literal notranslate"><span class="pre">List[str]</span></code>, multiple columns will be tokenized.</p></li>
<li><p><strong>validation_split</strong> – Fraction of the dataset to be used for validation.
If set to <code class="docutils literal notranslate"><span class="pre">0.0</span></code>, it will not create additional validation split.</p></li>
<li><p><strong>shuffle</strong> – Whether to shuffle the dataset.</p></li>
<li><p><strong>seed</strong> – Random seed.</p></li>
<li><p><strong>num_workers</strong> – Number of workers to use for tokenizing.</p></li>
<li><p><strong>use_eos_token</strong> – Whether to use the EOS token to separate sequences.</p></li>
<li><p><strong>use_shared_memory</strong> – Whether to use the shared memory for caching.</p></li>
<li><p><strong>cache_dir</strong> – Output directory where dataset will be cached.</p></li>
<li><p><strong>raw_dir</strong> – Output directory where raw dataset will be saved.
If set to <code class="docutils literal notranslate"><span class="pre">None</span></code>, the raw dataset will not be saved.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dataset provider.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.from_cache">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_cache</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cache_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider" title="phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider"><span class="pre">LMDatasetProvider</span></a></span></span><a class="reference internal" href="../_modules/phyagi/datasets/train/lm/lm_dataset_provider.html#LMDatasetProvider.from_cache"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.from_cache" title="Link to this definition">#</a></dt>
<dd><p>Load a dataset provider from a cache directory.</p>
<p>If a cached file (<code class="docutils literal notranslate"><span class="pre">train.npy</span></code>, <code class="docutils literal notranslate"><span class="pre">validation.npy</span></code> or <code class="docutils literal notranslate"><span class="pre">tokenizer.pkl</span></code>)
is missing, it will be set to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>cache_dir</strong> – Cached dataset directory.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dataset provider.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.get_train_dataset">
<span class="sig-name descname"><span class="pre">get_train_dataset</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#phyagi.datasets.train.lm.lm_dataset.LMDataset" title="phyagi.datasets.train.lm.lm_dataset.LMDataset"><span class="pre">LMDataset</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/train/lm/lm_dataset_provider.html#LMDatasetProvider.get_train_dataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.get_train_dataset" title="Link to this definition">#</a></dt>
<dd><p>Get a training dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>An instance of a training dataset.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.get_val_dataset">
<span class="sig-name descname"><span class="pre">get_val_dataset</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#phyagi.datasets.train.lm.lm_dataset.LMDataset" title="phyagi.datasets.train.lm.lm_dataset.LMDataset"><span class="pre">LMDataset</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/train/lm/lm_dataset_provider.html#LMDatasetProvider.get_val_dataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.get_val_dataset" title="Link to this definition">#</a></dt>
<dd><p>Get a validation dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>An instance of a validation dataset.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.get_tokenizer">
<span class="sig-name descname"><span class="pre">get_tokenizer</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">PreTrainedTokenizerBase</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/train/lm/lm_dataset_provider.html#LMDatasetProvider.get_tokenizer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.get_tokenizer" title="Link to this definition">#</a></dt>
<dd><p>Get a tokenizer.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>An instance of a tokenizer.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProviderConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.</span></span><span class="sig-name descname"><span class="pre">StreamLMDatasetProviderConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seq_len</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2048</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift_labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">42</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phyagi/datasets/train/stream_lm/stream_lm_dataset_provider.html#StreamLMDatasetProviderConfig"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProviderConfig" title="Link to this definition">#</a></dt>
<dd><p>Stream (non-tokenized) language modeling dataset provider configuration.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset_path</strong> – Path of the dataset when loading with <code class="xref py py-meth docutils literal notranslate"><span class="pre">datasets.load_dataset()</span></code>.</p></li>
<li><p><strong>seq_len</strong> – Sequence length.</p></li>
<li><p><strong>shift_labels</strong> – Whether to shift labels.</p></li>
<li><p><strong>weight</strong> – Weight for the dataset.</p></li>
<li><p><strong>label</strong> – Label for the dataset.</p></li>
<li><p><strong>seed</strong> – Random seed.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProviderConfig.from_dict">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProviderConfig" title="phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProviderConfig"><span class="pre">StreamLMDatasetProviderConfig</span></a></span></span><a class="reference internal" href="../_modules/phyagi/datasets/train/stream_lm/stream_lm_dataset_provider.html#StreamLMDatasetProviderConfig.from_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProviderConfig.from_dict" title="Link to this definition">#</a></dt>
<dd><p>Load a configuration from a dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>config_dict</strong> – Dictionary containing the configuration.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Configuration.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProviderConfig.to_dict">
<span class="sig-name descname"><span class="pre">to_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/train/stream_lm/stream_lm_dataset_provider.html#StreamLMDatasetProviderConfig.to_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProviderConfig.to_dict" title="Link to this definition">#</a></dt>
<dd><p>Convert the configuration to a dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dictionary containing the configuration.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProviderConfig.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seq_len</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2048</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift_labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">42</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProviderConfig.__init__" title="Link to this definition">#</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.</span></span><span class="sig-name descname"><span class="pre">StreamLMDatasetProvider</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seq_len</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2048</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift_labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phyagi/datasets/train/stream_lm/stream_lm_dataset_provider.html#StreamLMDatasetProvider"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProvider" title="Link to this definition">#</a></dt>
<dd><p>Stream (non-tokenized) language modeling dataset provider.</p>
<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProvider.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seq_len</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2048</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift_labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/train/stream_lm/stream_lm_dataset_provider.html#StreamLMDatasetProvider.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProvider.__init__" title="Link to this definition">#</a></dt>
<dd><p>Initialize the dataset provider.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset_path</strong> – Path of the dataset when loading with <code class="xref py py-meth docutils literal notranslate"><span class="pre">datasets.load_dataset()</span></code>.</p></li>
<li><p><strong>seq_len</strong> – Sequence length.</p></li>
<li><p><strong>shift_labels</strong> – Whether to shift labels.</p></li>
<li><p><strong>weight</strong> – Weight for the dataset.</p></li>
<li><p><strong>label</strong> – Label for the dataset.</p></li>
<li><p><strong>seed</strong> – Random seed.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProvider.get_train_dataset">
<span class="sig-name descname"><span class="pre">get_train_dataset</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset" title="phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset"><span class="pre">StreamLMDataset</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/train/stream_lm/stream_lm_dataset_provider.html#StreamLMDatasetProvider.get_train_dataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProvider.get_train_dataset" title="Link to this definition">#</a></dt>
<dd><p>Get a training dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>An instance of a training dataset.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProvider.get_val_dataset">
<span class="sig-name descname"><span class="pre">get_val_dataset</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/train/stream_lm/stream_lm_dataset_provider.html#StreamLMDatasetProvider.get_val_dataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProvider.get_val_dataset" title="Link to this definition">#</a></dt>
<dd><p>Get a validation dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>An instance of a validation dataset.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProvider.get_tokenizer">
<span class="sig-name descname"><span class="pre">get_tokenizer</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/train/stream_lm/stream_lm_dataset_provider.html#StreamLMDatasetProvider.get_tokenizer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProvider.get_tokenizer" title="Link to this definition">#</a></dt>
<dd><p>Get a tokenizer.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>An instance of a tokenizer.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="id1">
<h3>Datasets<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="phyagi.datasets.train.lm.lm_dataset.LMDataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phyagi.datasets.train.lm.lm_dataset.</span></span><span class="sig-name descname"><span class="pre">LMDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_ids</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">array</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seq_len</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2048</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift_labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_token_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_mask_prob</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_mask_offset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">32768</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">42</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phyagi/datasets/train/lm/lm_dataset.html#LMDataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.lm.lm_dataset.LMDataset" title="Link to this definition">#</a></dt>
<dd><p>Language modeling dataset.</p>
<p>This dataset is used for language modeling tasks. It takes a contiguous array
of tokens and convert it into a dataset of sequences of length <code class="docutils literal notranslate"><span class="pre">seq_len</span></code> by
sliding a window of size <code class="docutils literal notranslate"><span class="pre">seq_len</span></code> over the array of tokens.</p>
<p>Each sequence is composed of <code class="docutils literal notranslate"><span class="pre">input_ids</span></code> and <code class="docutils literal notranslate"><span class="pre">labels</span></code> tensors.</p>
<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.train.lm.lm_dataset.LMDataset.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_ids</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">array</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seq_len</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2048</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift_labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_token_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_mask_prob</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_mask_offset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">32768</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">42</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/train/lm/lm_dataset.html#LMDataset.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.lm.lm_dataset.LMDataset.__init__" title="Link to this definition">#</a></dt>
<dd><p>Initialize the dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_ids</strong> – Inputs array (encoded data).</p></li>
<li><p><strong>seq_len</strong> – Sequence length.</p></li>
<li><p><strong>labels</strong> – Labels array (encoded data).
If <code class="docutils literal notranslate"><span class="pre">None</span></code>, the labels will be inferred from the <code class="docutils literal notranslate"><span class="pre">input_ids</span></code>.</p></li>
<li><p><strong>shift_labels</strong> – Whether labels must be shifted by one position.</p></li>
<li><p><strong>ignore_token_id</strong> – Index to be ignored in the labels.</p></li>
<li><p><strong>random_mask_prob</strong> – Probability of applying a mask that ignores random samples (sequence lengths).
If <code class="docutils literal notranslate"><span class="pre">None</span></code>, ignores masking.</p></li>
<li><p><strong>random_mask_offset</strong> – Value added to the token that will cause it to be masked.</p></li>
<li><p><strong>seed</strong> – Seed for the mask random number generator.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="phyagi.datasets.train.lm.lm_dataset.LMDataset.seq_len">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">seq_len</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#phyagi.datasets.train.lm.lm_dataset.LMDataset.seq_len" title="Link to this definition">#</a></dt>
<dd><p>Sequence length of the dataset used for logging.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phyagi.datasets.train.stream_lm.stream_lm_dataset.</span></span><span class="sig-name descname"><span class="pre">StreamLMDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_ids</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">array</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seq_len</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2048</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift_labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">read_ahead</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2048</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chunk_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1024</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phyagi/datasets/train/stream_lm/stream_lm_dataset.html#StreamLMDataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset" title="Link to this definition">#</a></dt>
<dd><p>Stream-based language modeling dataset.</p>
<p>Each element is a fixed-length sequence of pre-tokenized token identifiers, while the dataset
is designed to be lazy and shard-aware, optimising for memory and I/O efficiency.</p>
<ul class="simple">
<li><p>Slices by rank: each data-parallel worker sees a disjoint slice of the dataset.</p></li>
<li><p>Prefetches contiguous chunks: maximises sequential disk I/O.</p></li>
<li><p>Keeps no duplicates in RAM: the buffer holds at most <code class="docutils literal notranslate"><span class="pre">read_ahead</span></code> rows.</p></li>
</ul>
<p>It is assumed that the labels are the same as the input ids (causal language modeling),
and therefore the <code class="docutils literal notranslate"><span class="pre">shift_labels</span></code> option is not supported. Additionally, the backing NumPy array
must be C-contiguous; otherwise, reshaping a mem-mapped file would trigger a full copy.</p>
<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_ids</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">array</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seq_len</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2048</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift_labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">read_ahead</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2048</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chunk_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1024</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/train/stream_lm/stream_lm_dataset.html#StreamLMDataset.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset.__init__" title="Link to this definition">#</a></dt>
<dd><p>Initialize the dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset_name</strong> – Unique name for the dataset.</p></li>
<li><p><strong>input_ids</strong> – 2D or 1D NumPy array (mem-mapped or in-memory) of token ids.
If 2D, its second dimension must equal <code class="docutils literal notranslate"><span class="pre">seq_len</span></code>.</p></li>
<li><p><strong>labels</strong> – Optional 2D or 1D NumPy array (mem-mapped or in-memory) of labels.
If provided, it must have the same shape as <code class="docutils literal notranslate"><span class="pre">input_ids</span></code>.</p></li>
<li><p><strong>seq_len</strong> – Length of each sequence (number of tokens).</p></li>
<li><p><strong>shift_labels</strong> – Whether to shift the labels by one token to the right.</p></li>
<li><p><strong>read_ahead</strong> – Minimum number of prefetched rows kept in the buffers used to controls the
trade-off between I/O throughput and RAM usage.</p></li>
<li><p><strong>chunk_size</strong> – Number of contiguous rows read in one refill call.
It must be <code class="docutils literal notranslate"><span class="pre">&gt;=</span> <span class="pre">read_ahead</span></code> to avoid double reads.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset.seq_len">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">seq_len</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset.seq_len" title="Link to this definition">#</a></dt>
<dd><p>Sequence length of the dataset used for logging.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset.set_rank_and_world_size">
<span class="sig-name descname"><span class="pre">set_rank_and_world_size</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rank</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">world_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/train/stream_lm/stream_lm_dataset.html#StreamLMDataset.set_rank_and_world_size"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset.set_rank_and_world_size" title="Link to this definition">#</a></dt>
<dd><p>Set the rank and world size for distributed training.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rank</strong> – Local rank in the data-parallel job (0 &lt;= rank &lt; world_size).</p></li>
<li><p><strong>world_size</strong> – Total number of data-parallel workers.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset.state_dict">
<span class="sig-name descname"><span class="pre">state_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/train/stream_lm/stream_lm_dataset.html#StreamLMDataset.state_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset.state_dict" title="Link to this definition">#</a></dt>
<dd><p>State of the dataset as a dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dictionary containing the current step count and the state of each dataset.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset.load_state_dict">
<span class="sig-name descname"><span class="pre">load_state_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/train/stream_lm/stream_lm_dataset.html#StreamLMDataset.load_state_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset.load_state_dict" title="Link to this definition">#</a></dt>
<dd><p>Load the state of the dataset from a dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> – Dictionary containing the state of the dataset.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="data-collators">
<h3>Data Collators<a class="headerlink" href="#data-collators" title="Link to this heading">#</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="phyagi.datasets.train.train_data_collator.LMDataCollator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phyagi.datasets.train.train_data_collator.</span></span><span class="sig-name descname"><span class="pre">LMDataCollator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ignore_token_ids</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_token_id_range</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-100</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phyagi/datasets/train/train_data_collator.html#LMDataCollator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.train.train_data_collator.LMDataCollator" title="Link to this definition">#</a></dt>
<dd><p>Data collator compatible with <a class="reference internal" href="#phyagi.datasets.train.lm.lm_dataset.LMDataset" title="phyagi.datasets.train.lm.lm_dataset.LMDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">phyagi.datasets.train.lm.lm_dataset.LMDataset</span></code></a> and
<a class="reference internal" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset" title="phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset</span></code></a>.</p>
<p>This class applies specific token masking based on given parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ignore_token_ids</strong> – List of token IDs to be ignored in the label.
Label tokens with these IDs will be replaced with the <code class="docutils literal notranslate"><span class="pre">ignore_index</span></code> value.</p></li>
<li><p><strong>ignore_token_id_range</strong> – Range of token IDs (inclusive) to be ignored (min, max) in the label.
Any label token within this range will be replaced with the <code class="docutils literal notranslate"><span class="pre">ignore_index</span></code> value.</p></li>
<li><p><strong>ignore_index</strong> – The index that will be used to replace ignored tokens in the labels.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">collator</span> <span class="o">=</span> <span class="n">LMDataCollator</span><span class="p">(</span><span class="n">ignore_token_ids</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">examples</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;labels&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span> <span class="o">=</span> <span class="n">collator</span><span class="p">(</span><span class="n">examples</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tensor</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.train.train_data_collator.LMDataCollator.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ignore_token_ids</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_token_id_range</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-100</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#phyagi.datasets.train.train_data_collator.LMDataCollator.__init__" title="Link to this definition">#</a></dt>
<dd></dd></dl>

</dd></dl>

</section>
</section>
<section id="module-phyagi.datasets.rl.formatting_utils">
<span id="reinforcement-learning"></span><h2>Reinforcement Learning<a class="headerlink" href="#module-phyagi.datasets.rl.formatting_utils" title="Link to this heading">#</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="phyagi.datasets.rl.formatting_utils.apply_chat_template">
<span class="sig-prename descclassname"><span class="pre">phyagi.datasets.rl.formatting_utils.</span></span><span class="sig-name descname"><span class="pre">apply_chat_template</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">example</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">special_token_format</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shuffle</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">add_mask_tokens</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">system_message_format</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'random'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">system_message_prob</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.25</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/rl/formatting_utils.html#apply_chat_template"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.rl.formatting_utils.apply_chat_template" title="Link to this definition">#</a></dt>
<dd><p>Apply chat template to a given example.</p>
<p>An example is a dictionary with task-related keys, e.g., <code class="docutils literal notranslate"><span class="pre">prompt</span></code>, <code class="docutils literal notranslate"><span class="pre">completion</span></code> <code class="docutils literal notranslate"><span class="pre">chosen</span></code>,
<code class="docutils literal notranslate"><span class="pre">rejected</span></code>, etc. each containing a list of messages, where each message is a dictionary with
<code class="docutils literal notranslate"><span class="pre">role</span></code> and <code class="docutils literal notranslate"><span class="pre">content</span></code>. For <code class="docutils literal notranslate"><span class="pre">prompt</span></code> key, an optional system message is additionally added
<code class="docutils literal notranslate"><span class="pre">system_message_format</span></code> and <code class="docutils literal notranslate"><span class="pre">system_message_prob</span></code> arguments.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>example</strong> – Example to apply chat template.</p></li>
<li><p><strong>special_token_format</strong> – Format of the special tokens, e.g., <code class="docutils literal notranslate"><span class="pre">phi</span></code> or <code class="docutils literal notranslate"><span class="pre">chatml</span></code>.</p></li>
<li><p><strong>shuffle</strong> – Whether to shuffle templates.</p></li>
<li><p><strong>add_mask_tokens</strong> – Whether to add mask tokens.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Example with chat template applied.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phyagi.datasets.rl.formatting_utils.patch_tokenizer_generation_tag">
<span class="sig-prename descclassname"><span class="pre">phyagi.datasets.rl.formatting_utils.</span></span><span class="sig-name descname"><span class="pre">patch_tokenizer_generation_tag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tokenizer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">PreTrainedTokenizerBase</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">PreTrainedTokenizerBase</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/rl/formatting_utils.html#patch_tokenizer_generation_tag"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.rl.formatting_utils.patch_tokenizer_generation_tag" title="Link to this definition">#</a></dt>
<dd><p>Patch a tokenizer if it does not have support for generating assistant masks (by using % generation % Jinja tags).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>tokenizer</strong> – Tokenizer to patch.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Tokenizer with patched generation tags.</p>
</dd>
</dl>
</dd></dl>

<dl class="py class" id="module-phyagi.datasets.rl.packing">
<dt class="sig sig-object py" id="phyagi.datasets.rl.packing.PackedBatch">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phyagi.datasets.rl.packing.</span></span><span class="sig-name descname"><span class="pre">PackedBatch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tokens</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LongTensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">masks</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BoolTensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">advantages</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">FloatTensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cu_seqlens</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">IntTensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valid_seqlens</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">IntTensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">position_ids</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LongTensor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">boundaries</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phyagi/datasets/rl/packing.html#PackedBatch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.rl.packing.PackedBatch" title="Link to this definition">#</a></dt>
<dd><p>Packed batch.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tokens</strong> – 2D tensor (rows x padded_length) of token identifiers.</p></li>
<li><p><strong>masks</strong> – 2D tensor (rows x padded_length) of boolean masks.</p></li>
<li><p><strong>advantages</strong> – 2D tensor (rows x padded_length) of advantages.</p></li>
<li><p><strong>cu_seqlens</strong> – 1D tensor of cumulative sequence lengths.</p></li>
<li><p><strong>valid_seqlens</strong> – 1D tensor of valid (mask=True) token lengths.</p></li>
<li><p><strong>position_ids</strong> – 2D tensor (rows x padded_length) of position identifiers.</p></li>
<li><p><strong>boundaries</strong> – Boundaries for each row in the packed batch.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.rl.packing.PackedBatch.to">
<span class="sig-name descname"><span class="pre">to</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">device</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#phyagi.datasets.rl.packing.PackedBatch" title="phyagi.datasets.rl.packing.PackedBatch"><span class="pre">PackedBatch</span></a></span></span><a class="reference internal" href="../_modules/phyagi/datasets/rl/packing.html#PackedBatch.to"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.rl.packing.PackedBatch.to" title="Link to this definition">#</a></dt>
<dd><p>Move the packed batch to the specified device.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>device</strong> – Target device (e.g., ‘cuda’ or ‘cpu’).</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Instance with tensors moved to the specified device.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.rl.packing.PackedBatch.to_dict">
<span class="sig-name descname"><span class="pre">to_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/rl/packing.html#PackedBatch.to_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.rl.packing.PackedBatch.to_dict" title="Link to this definition">#</a></dt>
<dd><p>Convert the packed batch to a dictionary of tensors.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dictionary with attributes as keys and tensors as values.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.rl.packing.PackedBatch.from_dict">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#phyagi.datasets.rl.packing.PackedBatch" title="phyagi.datasets.rl.packing.PackedBatch"><span class="pre">PackedBatch</span></a></span></span><a class="reference internal" href="../_modules/phyagi/datasets/rl/packing.html#PackedBatch.from_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.rl.packing.PackedBatch.from_dict" title="Link to this definition">#</a></dt>
<dd><p>Create a packed batch from a dictionary of tensors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data</strong> – Dictionary with attributes as keys and tensors as values.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Instance with tensors set from the dictionary.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phyagi.datasets.rl.packing.distribute_and_pack_sequences">
<span class="sig-prename descclassname"><span class="pre">phyagi.datasets.rl.packing.</span></span><span class="sig-name descname"><span class="pre">distribute_and_pack_sequences</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sequences</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">assistant_masks</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">advantages</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dp_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cp_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tp_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pad_token_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize_adv_num_tokens</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">micro_batch_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pad_to_largest_micro_batch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#phyagi.datasets.rl.packing.PackedBatch" title="phyagi.datasets.rl.packing.PackedBatch"><span class="pre">PackedBatch</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/rl/packing.html#distribute_and_pack_sequences"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.rl.packing.distribute_and_pack_sequences" title="Link to this definition">#</a></dt>
<dd><p>Pack token sequences into GPU buckets and (if requested) splits each bucket into micro batches.</p>
<p>The input sequences (with matching <code class="docutils literal notranslate"><span class="pre">assistant_masks</span></code> and <code class="docutils literal notranslate"><span class="pre">advantages</span></code>) are first processed by pairing
each token with its corresponding mask and advantage (normalized if needed). The sequences are then
packed into GPU buckets (each bucket is a list of rows containing one or more packed sequences).</p>
<p>If <code class="docutils literal notranslate"><span class="pre">micro_batch_size</span></code> is provided, each GPU bucket’s rows are split into micro batches (each micro batch
is a sublist of rows of <code class="docutils literal notranslate"><span class="pre">length</span> <span class="pre">&lt;=</span> <span class="pre">micro_batch_size</span></code>). For each micro batch, padded tensors and a
flattened cumulative sequence length vector (<code class="docutils literal notranslate"><span class="pre">cu_seqlens</span></code>) are created.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">pad_to_largest_micro_batch=True</span></code>, the micro batches are padded so each device receives the same number of
micro batches. This is useful for distributed training to avoid gradient synchronization issues with FSDP.
The extra micro batches added will contain just 2 padding tokens.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sequences</strong> – List of sequences (each sequence is a list of token identifiers).</p></li>
<li><p><strong>assistant_masks</strong> – List of boolean masks indicating which tokens are valid.</p></li>
<li><p><strong>advantages</strong> – List of advantage values for each token.</p></li>
<li><p><strong>max_length</strong> – Maximum length of sequences (used for padding).</p></li>
<li><p><strong>dp_size</strong> – Number of data parallel workers.</p></li>
<li><p><strong>cp_size</strong> – Number of context parallel workers.</p></li>
<li><p><strong>tp_size</strong> – Number of tensor parallel workers.</p></li>
<li><p><strong>pad_token_id</strong> – Token identifier used for padding.</p></li>
<li><p><strong>normalize_adv_num_tokens</strong> – Whether to normalize the advantage by the number of valid tokens.</p></li>
<li><p><strong>micro_batch_size</strong> – Size of micro batches.
If <code class="docutils literal notranslate"><span class="pre">None</span></code>, no micro batching is applied.</p></li>
<li><p><strong>pad_to_largest_micro_batch</strong> – Whether to pad micro batches to the largest size across GPUs.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dictionary mapping GPU index to a list of <code class="docutils literal notranslate"><span class="pre">PackedBatch</span></code> instances (one per micro batch). Even if
micro batching is not applied, the GPU index will map to a list containing a single <code class="docutils literal notranslate"><span class="pre">PackedBatch</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function" id="module-phyagi.datasets.rl.special_tokens">
<dt class="sig sig-object py" id="phyagi.datasets.rl.special_tokens.get_special_token">
<span class="sig-prename descclassname"><span class="pre">phyagi.datasets.rl.special_tokens.</span></span><span class="sig-name descname"><span class="pre">get_special_token</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">special_token_format</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">special_token_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/rl/special_tokens.html#get_special_token"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.rl.special_tokens.get_special_token" title="Link to this definition">#</a></dt>
<dd><p>Get a special token or a dictionary of special tokens.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>special_token_format</strong> – Format of the special tokens.</p></li>
<li><p><strong>special_token_type</strong> – Type of the special token.
If <code class="docutils literal notranslate"><span class="pre">None</span></code>, returns all special tokens for the given format.
If specified, must be one of the keys in the dictionary for the given format.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Special token or a dictionary of special tokens.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phyagi.datasets.rl.special_tokens.get_mask_token">
<span class="sig-prename descclassname"><span class="pre">phyagi.datasets.rl.special_tokens.</span></span><span class="sig-name descname"><span class="pre">get_mask_token</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mask_token_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/rl/special_tokens.html#get_mask_token"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.rl.special_tokens.get_mask_token" title="Link to this definition">#</a></dt>
<dd><p>Get a mask token.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>mask_token_type</strong> – Type of the mask token.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Mask token.</p>
</dd>
</dl>
</dd></dl>

<section id="id2">
<h3>Datasets Providers<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProviderConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phyagi.datasets.rl.chat.chat_dataset_provider.</span></span><span class="sig-name descname"><span class="pre">ChatDatasetProviderConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">train_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tokenizer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">PreTrainedTokenizerBase</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">messages_column_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'question'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ground_truth_column_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'answer'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1024</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_max_length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tokenize</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subsample</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phyagi/datasets/rl/chat/chat_dataset_provider.html#ChatDatasetProviderConfig"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProviderConfig" title="Link to this definition">#</a></dt>
<dd><p>Chat dataset provider configuration.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>train_file</strong> – Path to the training file.</p></li>
<li><p><strong>validation_file</strong> – Path to the validation file.</p></li>
<li><p><strong>tokenizer</strong> – Instance of tokenizer to use.
If type is <code class="docutils literal notranslate"><span class="pre">str</span></code>, will use <code class="xref py py-class docutils literal notranslate"><span class="pre">transformers.AutoTokenizer</span></code> to load the tokenizer.
If type is <code class="docutils literal notranslate"><span class="pre">dict</span></code>, will use <code class="xref py py-class docutils literal notranslate"><span class="pre">transformers.AutoTokenizer</span></code> and keyword arguments to load the tokenizer.</p></li>
<li><p><strong>messages_column_name</strong> – Column name for the messages.</p></li>
<li><p><strong>ground_truth_column_name</strong> – Column name for the ground truth.</p></li>
<li><p><strong>max_length</strong> – Maximum sequence length.</p></li>
<li><p><strong>filter_max_length</strong> – Whether it should filter sequences longer than <code class="docutils literal notranslate"><span class="pre">max_length</span></code> during pre-tokenization.</p></li>
<li><p><strong>tokenize</strong> – Whether it should pre-tokenize the data.</p></li>
<li><p><strong>weight</strong> – Weight for the dataset.</p></li>
<li><p><strong>label</strong> – Label for the dataset.</p></li>
<li><p><strong>subsample</strong> – Fraction of the dataset to use.
If <code class="docutils literal notranslate"><span class="pre">None</span></code>, no subsampling is applied.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProviderConfig.from_dict">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProviderConfig" title="phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProviderConfig"><span class="pre">ChatDatasetProviderConfig</span></a></span></span><a class="reference internal" href="../_modules/phyagi/datasets/rl/chat/chat_dataset_provider.html#ChatDatasetProviderConfig.from_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProviderConfig.from_dict" title="Link to this definition">#</a></dt>
<dd><p>Load a configuration from a dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>config_dict</strong> – Dictionary containing the configuration.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Configuration.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProviderConfig.to_dict">
<span class="sig-name descname"><span class="pre">to_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/rl/chat/chat_dataset_provider.html#ChatDatasetProviderConfig.to_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProviderConfig.to_dict" title="Link to this definition">#</a></dt>
<dd><p>Convert the configuration to a dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dictionary containing the configuration.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProviderConfig.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">train_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tokenizer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">PreTrainedTokenizerBase</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">messages_column_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'question'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ground_truth_column_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'answer'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1024</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_max_length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tokenize</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subsample</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProviderConfig.__init__" title="Link to this definition">#</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProvider">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phyagi.datasets.rl.chat.chat_dataset_provider.</span></span><span class="sig-name descname"><span class="pre">ChatDatasetProvider</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">train_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tokenizer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">PreTrainedTokenizerBase</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">messages_column_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'messages'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ground_truth_column_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'ground_truth'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_max_length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tokenize</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subsample</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phyagi/datasets/rl/chat/chat_dataset_provider.html#ChatDatasetProvider"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProvider" title="Link to this definition">#</a></dt>
<dd><p>Chat dataset provider.</p>
<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProvider.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">train_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tokenizer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">PreTrainedTokenizerBase</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">messages_column_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'messages'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ground_truth_column_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'ground_truth'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_max_length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tokenize</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subsample</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/rl/chat/chat_dataset_provider.html#ChatDatasetProvider.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProvider.__init__" title="Link to this definition">#</a></dt>
<dd><p>Initialize the dataset provider.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>train_file</strong> – Path to the training file.</p></li>
<li><p><strong>validation_file</strong> – Path to the validation file.</p></li>
<li><p><strong>tokenizer</strong> – Instance of tokenizer to use.
If type is <code class="docutils literal notranslate"><span class="pre">str</span></code>, will use <code class="xref py py-class docutils literal notranslate"><span class="pre">transformers.AutoTokenizer</span></code> to load the tokenizer.
If type is <code class="docutils literal notranslate"><span class="pre">dict</span></code>, will use <code class="xref py py-class docutils literal notranslate"><span class="pre">transformers.AutoTokenizer</span></code> and keyword arguments to load the tokenizer.</p></li>
<li><p><strong>messages_column_name</strong> – Column name for the messages.</p></li>
<li><p><strong>ground_truth_column_name</strong> – Column name for the ground truth.</p></li>
<li><p><strong>max_length</strong> – Maximum sequence length.</p></li>
<li><p><strong>filter_max_length</strong> – Whether it should filter sequences longer than <code class="docutils literal notranslate"><span class="pre">max_length</span></code> during pre-tokenization.</p></li>
<li><p><strong>tokenize</strong> – Whether it should pre-tokenize the data.</p></li>
<li><p><strong>weight</strong> – Weight for the dataset.</p></li>
<li><p><strong>label</strong> – Label for the dataset.</p></li>
<li><p><strong>subsample</strong> – Fraction of the dataset to use.
If <code class="docutils literal notranslate"><span class="pre">None</span></code>, no subsampling is applied.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProvider.get_train_dataset">
<span class="sig-name descname"><span class="pre">get_train_dataset</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#phyagi.datasets.rl.chat.chat_dataset.ChatDataset" title="phyagi.datasets.rl.chat.chat_dataset.ChatDataset"><span class="pre">ChatDataset</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/rl/chat/chat_dataset_provider.html#ChatDatasetProvider.get_train_dataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProvider.get_train_dataset" title="Link to this definition">#</a></dt>
<dd><p>Get a training dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>An instance of a training dataset.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProvider.get_val_dataset">
<span class="sig-name descname"><span class="pre">get_val_dataset</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#phyagi.datasets.rl.chat.chat_dataset.ChatDataset" title="phyagi.datasets.rl.chat.chat_dataset.ChatDataset"><span class="pre">ChatDataset</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/rl/chat/chat_dataset_provider.html#ChatDatasetProvider.get_val_dataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProvider.get_val_dataset" title="Link to this definition">#</a></dt>
<dd><p>Get a validation dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>An instance of a validation dataset.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProvider.get_tokenizer">
<span class="sig-name descname"><span class="pre">get_tokenizer</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">PreTrainedTokenizerBase</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/rl/chat/chat_dataset_provider.html#ChatDatasetProvider.get_tokenizer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProvider.get_tokenizer" title="Link to this definition">#</a></dt>
<dd><p>Get a tokenizer.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>An instance of a tokenizer.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="id3">
<h3>Datasets<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="phyagi.datasets.rl.chat.chat_dataset.ChatDataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phyagi.datasets.rl.chat.chat_dataset.</span></span><span class="sig-name descname"><span class="pre">ChatDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dataset</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DatasetDict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tokenizer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">PreTrainedTokenizerBase</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">messages_column_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'messages'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ground_truth_column_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_max_length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tokenize</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phyagi/datasets/rl/chat/chat_dataset.html#ChatDataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.rl.chat.chat_dataset.ChatDataset" title="Link to this definition">#</a></dt>
<dd><p>Chat dataset.</p>
<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.rl.chat.chat_dataset.ChatDataset.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dataset</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DatasetDict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tokenizer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">PreTrainedTokenizerBase</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">messages_column_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'messages'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ground_truth_column_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_max_length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tokenize</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/rl/chat/chat_dataset.html#ChatDataset.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.rl.chat.chat_dataset.ChatDataset.__init__" title="Link to this definition">#</a></dt>
<dd><p>Initialize the dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset</strong> – Dataset or dataset dictionary.</p></li>
<li><p><strong>tokenizer</strong> – Tokenizer to use for encoding the dataset.</p></li>
<li><p><strong>messages_column_name</strong> – Column name for messages in the dataset.</p></li>
<li><p><strong>ground_truth_column_name</strong> – Column name for ground truth in the dataset.</p></li>
<li><p><strong>max_length</strong> – Maximum length of the input sequences.</p></li>
<li><p><strong>filter_max_length</strong> – Whether to filter sequences longer than <code class="docutils literal notranslate"><span class="pre">max_length</span></code>.</p></li>
<li><p><strong>tokenize</strong> – Whether to pre-tokenize the dataset.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="id4">
<h3>Data Collators<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="phyagi.datasets.rl.rl_data_collator.RewardDataCollator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phyagi.datasets.rl.rl_data_collator.</span></span><span class="sig-name descname"><span class="pre">RewardDataCollator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reward_names:</span> <span class="pre">~typing.List[str]</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reward_weights:</span> <span class="pre">~typing.List[float]</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phyagi/datasets/rl/rl_data_collator.html#RewardDataCollator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.rl.rl_data_collator.RewardDataCollator" title="Link to this definition">#</a></dt>
<dd><p>Data collator compatible with <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.utils.data.Dataset</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>reward_names</strong> – List of reward names.</p></li>
<li><p><strong>reward_weights</strong> – List of reward weights.
If <code class="docutils literal notranslate"><span class="pre">None</span></code>, equal weights are used.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">collator</span> <span class="o">=</span> <span class="n">RewardDataCollator</span><span class="p">(</span><span class="n">reward_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;reward1&quot;</span><span class="p">,</span> <span class="s2">&quot;reward2&quot;</span><span class="p">],</span> <span class="n">reward_weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">examples</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;input_ids&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span> <span class="o">=</span> <span class="n">collator</span><span class="p">(</span><span class="n">examples</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="s1">&#39;reward_names&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="s1">&#39;reward1&#39;</span><span class="p">,</span> <span class="s1">&#39;reward2&#39;</span><span class="p">]],</span> <span class="s1">&#39;reward_weights&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]],</span> <span class="s1">&#39;input_ids&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])]}</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="phyagi.datasets.rl.rl_data_collator.RewardDataCollator.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reward_names:</span> <span class="pre">~typing.List[str]</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reward_weights:</span> <span class="pre">~typing.List[float]</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#phyagi.datasets.rl.rl_data_collator.RewardDataCollator.__init__" title="Link to this definition">#</a></dt>
<dd></dd></dl>

</dd></dl>

</section>
</section>
<section id="module-phyagi.datasets.registry">
<span id="registry"></span><h2>Registry<a class="headerlink" href="#module-phyagi.datasets.registry" title="Link to this heading">#</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="phyagi.datasets.registry.get_dataset">
<span class="sig-prename descclassname"><span class="pre">phyagi.datasets.registry.</span></span><span class="sig-name descname"><span class="pre">get_dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset_configs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset_concat</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'random'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eval_dataset_concat</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset_provider</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'lm'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset_global_weight</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Dataset</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Dataset</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/registry.html#get_dataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.registry.get_dataset" title="Link to this definition">#</a></dt>
<dd><p>Get a tuple of training and evaluation datasets.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset_configs</strong> – Dataset configuration.</p></li>
<li><p><strong>dataset_concat</strong> – Dataset concatenation strategy (for training).</p></li>
<li><p><strong>eval_dataset_concat</strong> – Dataset concatenation strategy (for evaluation).</p></li>
<li><p><strong>dataset_provider</strong> – Dataset provider type.
If any item from <cite>dataset_configs</cite> does not contain <cite>dataset_provider</cite>, it will be used as default.</p></li>
<li><p><strong>dataset_global_weight</strong> – Global weight multiplier applied to all datasets.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Training and evaluation datasets.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phyagi.datasets.registry.get_data_collator">
<span class="sig-prename descclassname"><span class="pre">phyagi.datasets.registry.</span></span><span class="sig-name descname"><span class="pre">get_data_collator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_collator_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'lm'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span><a class="reference internal" href="../_modules/phyagi/datasets/registry.html#get_data_collator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phyagi.datasets.registry.get_data_collator" title="Link to this definition">#</a></dt>
<dd><p>Get a data collator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data_collator_type</strong> – Data collator type.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Data collator.</p>
</dd>
</dl>
</dd></dl>

</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../contributing/tests.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Tests</p>
      </div>
    </a>
    <a class="right-next"
       href="models.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Models</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Sections
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-providers-abstract">Dataset Providers (Abstract)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.dataset_provider.DatasetProvider"><code class="docutils literal notranslate"><span class="pre">DatasetProvider</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.dataset_provider.DatasetProvider.__init__"><code class="docutils literal notranslate"><span class="pre">DatasetProvider.__init__()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.dataset_provider.DatasetProvider.from_config"><code class="docutils literal notranslate"><span class="pre">DatasetProvider.from_config()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.dataset_provider.DatasetProvider.get_train_dataset"><code class="docutils literal notranslate"><span class="pre">DatasetProvider.get_train_dataset()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.dataset_provider.DatasetProvider.get_val_dataset"><code class="docutils literal notranslate"><span class="pre">DatasetProvider.get_val_dataset()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.dataset_provider.DatasetProvider.get_tokenizer"><code class="docutils literal notranslate"><span class="pre">DatasetProvider.get_tokenizer()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.dataset_provider.DatasetProviderConfig"><code class="docutils literal notranslate"><span class="pre">DatasetProviderConfig</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.dataset_provider.DatasetProviderConfig.from_dict"><code class="docutils literal notranslate"><span class="pre">DatasetProviderConfig.from_dict()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.dataset_provider.DatasetProviderConfig.to_dict"><code class="docutils literal notranslate"><span class="pre">DatasetProviderConfig.to_dict()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.dataset_provider.DatasetProviderConfig.__init__"><code class="docutils literal notranslate"><span class="pre">DatasetProviderConfig.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#datasets-concatenation">Datasets Concatenation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatDataset"><code class="docutils literal notranslate"><span class="pre">WeightedConcatDataset</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatDataset.__init__"><code class="docutils literal notranslate"><span class="pre">WeightedConcatDataset.__init__()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatDataset.seq_len"><code class="docutils literal notranslate"><span class="pre">WeightedConcatDataset.seq_len</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.SequentialWeightedConcatDataset"><code class="docutils literal notranslate"><span class="pre">SequentialWeightedConcatDataset</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.SequentialWeightedConcatDataset.__init__"><code class="docutils literal notranslate"><span class="pre">SequentialWeightedConcatDataset.__init__()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset"><code class="docutils literal notranslate"><span class="pre">WeightedConcatIterableDataset</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.__init__"><code class="docutils literal notranslate"><span class="pre">WeightedConcatIterableDataset.__init__()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.seq_len"><code class="docutils literal notranslate"><span class="pre">WeightedConcatIterableDataset.seq_len</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.set_rank_and_world_size"><code class="docutils literal notranslate"><span class="pre">WeightedConcatIterableDataset.set_rank_and_world_size()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.state_dict"><code class="docutils literal notranslate"><span class="pre">WeightedConcatIterableDataset.state_dict()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.load_state_dict"><code class="docutils literal notranslate"><span class="pre">WeightedConcatIterableDataset.load_state_dict()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.save_state"><code class="docutils literal notranslate"><span class="pre">WeightedConcatIterableDataset.save_state()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatIterableDataset.load_state"><code class="docutils literal notranslate"><span class="pre">WeightedConcatIterableDataset.load_state()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatChatDataset"><code class="docutils literal notranslate"><span class="pre">WeightedConcatChatDataset</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.concat_dataset.WeightedConcatChatDataset.__init__"><code class="docutils literal notranslate"><span class="pre">WeightedConcatChatDataset.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-training">Pre-training</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#datasets-providers">Datasets Providers</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider"><code class="docutils literal notranslate"><span class="pre">LMDatasetProvider</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.__init__"><code class="docutils literal notranslate"><span class="pre">LMDatasetProvider.__init__()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.from_hub"><code class="docutils literal notranslate"><span class="pre">LMDatasetProvider.from_hub()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.from_cache"><code class="docutils literal notranslate"><span class="pre">LMDatasetProvider.from_cache()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.get_train_dataset"><code class="docutils literal notranslate"><span class="pre">LMDatasetProvider.get_train_dataset()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.get_val_dataset"><code class="docutils literal notranslate"><span class="pre">LMDatasetProvider.get_val_dataset()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.lm.lm_dataset_provider.LMDatasetProvider.get_tokenizer"><code class="docutils literal notranslate"><span class="pre">LMDatasetProvider.get_tokenizer()</span></code></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProviderConfig"><code class="docutils literal notranslate"><span class="pre">StreamLMDatasetProviderConfig</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProviderConfig.from_dict"><code class="docutils literal notranslate"><span class="pre">StreamLMDatasetProviderConfig.from_dict()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProviderConfig.to_dict"><code class="docutils literal notranslate"><span class="pre">StreamLMDatasetProviderConfig.to_dict()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProviderConfig.__init__"><code class="docutils literal notranslate"><span class="pre">StreamLMDatasetProviderConfig.__init__()</span></code></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProvider"><code class="docutils literal notranslate"><span class="pre">StreamLMDatasetProvider</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProvider.__init__"><code class="docutils literal notranslate"><span class="pre">StreamLMDatasetProvider.__init__()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProvider.get_train_dataset"><code class="docutils literal notranslate"><span class="pre">StreamLMDatasetProvider.get_train_dataset()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProvider.get_val_dataset"><code class="docutils literal notranslate"><span class="pre">StreamLMDatasetProvider.get_val_dataset()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset_provider.StreamLMDatasetProvider.get_tokenizer"><code class="docutils literal notranslate"><span class="pre">StreamLMDatasetProvider.get_tokenizer()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Datasets</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.lm.lm_dataset.LMDataset"><code class="docutils literal notranslate"><span class="pre">LMDataset</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.lm.lm_dataset.LMDataset.__init__"><code class="docutils literal notranslate"><span class="pre">LMDataset.__init__()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.lm.lm_dataset.LMDataset.seq_len"><code class="docutils literal notranslate"><span class="pre">LMDataset.seq_len</span></code></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset"><code class="docutils literal notranslate"><span class="pre">StreamLMDataset</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset.__init__"><code class="docutils literal notranslate"><span class="pre">StreamLMDataset.__init__()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset.seq_len"><code class="docutils literal notranslate"><span class="pre">StreamLMDataset.seq_len</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset.set_rank_and_world_size"><code class="docutils literal notranslate"><span class="pre">StreamLMDataset.set_rank_and_world_size()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset.state_dict"><code class="docutils literal notranslate"><span class="pre">StreamLMDataset.state_dict()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.stream_lm.stream_lm_dataset.StreamLMDataset.load_state_dict"><code class="docutils literal notranslate"><span class="pre">StreamLMDataset.load_state_dict()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-collators">Data Collators</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.train_data_collator.LMDataCollator"><code class="docutils literal notranslate"><span class="pre">LMDataCollator</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.train.train_data_collator.LMDataCollator.__init__"><code class="docutils literal notranslate"><span class="pre">LMDataCollator.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-phyagi.datasets.rl.formatting_utils">Reinforcement Learning</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.formatting_utils.apply_chat_template"><code class="docutils literal notranslate"><span class="pre">apply_chat_template()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.formatting_utils.patch_tokenizer_generation_tag"><code class="docutils literal notranslate"><span class="pre">patch_tokenizer_generation_tag()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.packing.PackedBatch"><code class="docutils literal notranslate"><span class="pre">PackedBatch</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.packing.PackedBatch.to"><code class="docutils literal notranslate"><span class="pre">PackedBatch.to()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.packing.PackedBatch.to_dict"><code class="docutils literal notranslate"><span class="pre">PackedBatch.to_dict()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.packing.PackedBatch.from_dict"><code class="docutils literal notranslate"><span class="pre">PackedBatch.from_dict()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.packing.distribute_and_pack_sequences"><code class="docutils literal notranslate"><span class="pre">distribute_and_pack_sequences()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.special_tokens.get_special_token"><code class="docutils literal notranslate"><span class="pre">get_special_token()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.special_tokens.get_mask_token"><code class="docutils literal notranslate"><span class="pre">get_mask_token()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Datasets Providers</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProviderConfig"><code class="docutils literal notranslate"><span class="pre">ChatDatasetProviderConfig</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProviderConfig.from_dict"><code class="docutils literal notranslate"><span class="pre">ChatDatasetProviderConfig.from_dict()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProviderConfig.to_dict"><code class="docutils literal notranslate"><span class="pre">ChatDatasetProviderConfig.to_dict()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProviderConfig.__init__"><code class="docutils literal notranslate"><span class="pre">ChatDatasetProviderConfig.__init__()</span></code></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProvider"><code class="docutils literal notranslate"><span class="pre">ChatDatasetProvider</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProvider.__init__"><code class="docutils literal notranslate"><span class="pre">ChatDatasetProvider.__init__()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProvider.get_train_dataset"><code class="docutils literal notranslate"><span class="pre">ChatDatasetProvider.get_train_dataset()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProvider.get_val_dataset"><code class="docutils literal notranslate"><span class="pre">ChatDatasetProvider.get_val_dataset()</span></code></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset_provider.ChatDatasetProvider.get_tokenizer"><code class="docutils literal notranslate"><span class="pre">ChatDatasetProvider.get_tokenizer()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Datasets</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset.ChatDataset"><code class="docutils literal notranslate"><span class="pre">ChatDataset</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.chat.chat_dataset.ChatDataset.__init__"><code class="docutils literal notranslate"><span class="pre">ChatDataset.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Data Collators</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.rl_data_collator.RewardDataCollator"><code class="docutils literal notranslate"><span class="pre">RewardDataCollator</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.rl.rl_data_collator.RewardDataCollator.__init__"><code class="docutils literal notranslate"><span class="pre">RewardDataCollator.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-phyagi.datasets.registry">Registry</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.registry.get_dataset"><code class="docutils literal notranslate"><span class="pre">get_dataset()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phyagi.datasets.registry.get_data_collator"><code class="docutils literal notranslate"><span class="pre">get_data_collator()</span></code></a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Microsoft
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
  Last updated on Sep 16, 2025.
  <br/>
</p>
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>